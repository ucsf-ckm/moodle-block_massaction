define(["jquery","core/str"],function(t,a){return{init:function(a){this.data=a,this.drawCheckboxes(this.data),this.populateMenus(this.data),t("#block-massaction-selectall").on("click",this.data,this.selectAllHandler),t("#block-massaction-selectsome").on("change",this.data,this.selectAllHandler),t("#block-massaction-selectnone").on("click",this.data,this.selectAllHandler),t("#block-massaction-outdent").on("click",this.data,this.actionHandler),t("#block-massaction-indent").on("click",this.data,this.actionHandler),t("#block-massaction-hide").on("click",this.data,this.actionHandler),t("#block-massaction-show").on("click",this.data,this.actionHandler),t("#block-massaction-delete").on("click",this.data,this.actionHandler),t("#block-massaction-move").on("change",this.data,this.actionHandler),t("#block-massaction-clone").on("change",this.data,this.actionHandler)},drawCheckboxes:function(a){var e="",s="",o="",n=0,c=0,i=0;for(i in a.sectionmodules)if(null!==i&&0!==t("#section-"+i).length)for(c in(e=t("#section-"+(o=i+" ul.section li.activity div.mod-indent-outer div")).children("span.actions")).length||(e=t("#section-"+o).children("div.actions")),a.sectionmodules[i])n=a.sectionmodules[i][c],(s=document.createElement("input")).type="checkbox",s.id="massaction-input-"+n,s.className="massaction-checkbox",e[c].appendChild(s)},populateMenus:function(a){var e=["block-massaction-selectsome","block-massaction-move","block-massaction-clone"],s=0,o="",n=0;for(n in a.sectionnames)for(s in e)(o=document.createElement("option")).text=a.sectionnames[n],o.value=n,"block-massaction-selectsome"===e[s]?n in a.sectionmodules?o.disabled=!1:o.disabled=!0:o.disabled=!1,t("#"+e[s]).append(o)},selectAllHandler:function(a){var e=!1,s=!1,o=!1,n="",c="",i="";switch(a.currentTarget.id){case"block-massaction-selectsome":o=!0;case"block-massaction-selectnone":s=!0,t("#block-massaction-selected-all").val("false");case"block-massaction-selectall":for(n in s||(e=!0,t("#block-massaction-selected-all").val("true")),a.data.sectionmodules)for(i in a.data.sectionmodules[n])c=a.data.sectionmodules[n][i],t("#massaction-input-"+c).length>0&&t("#massaction-input-"+c).prop("checked",e);if(!0===o)for(i in n=a.target.value,a.data.sectionmodules[n])c=a.data.sectionmodules[n][i],t("#massaction-input-"+c).length>0&&t("#massaction-input-"+c).prop("checked",!0);else t("#block-massaction-selectsome").val("all")}},actionHandler:function(e){var s,o=new Array,n=0,c=e.data.courseformat,i="",l=null,d=t("#block-massaction-selectsome").val(),m="";if("onetopic"===c){var r=t("li.active:eq(0)")[0].textContent,u=t("li[aria-label='"+r+"']").attr("id");n=(u=u.split("-"))[1]}t("#block-massaction-selected-section").val(d);var h=e.currentTarget.id.split("-"),k=h[h.length-1];switch(d){case"all":for(d in e.data.sectionmodules)for(l in e.data.sectionmodules[d])i=e.data.sectionmodules[d][l],("onetopic"===c&&n===d||"onetopic"!==c)&&t("#massaction-input-"+i).length>0&&t("#massaction-input-"+i).is(":checked")?o.push(i):"true"===t("#block-massaction-selected-all").val()&&"onetopic"===c&&n!==d&&o.push(i);break;default:for(l in e.data.sectionmodules[d])i=e.data.sectionmodules[d][l],("onetopic"===c&&n===d||"onetopic"!==c)&&t("#massaction-input-"+i).length>0&&t("#massaction-input-"+i).is(":checked")?o.push(i):"onetopic"===c&&n!==d&&o.push(i)}switch(s=o.length,k){case"delete":if(s>0){var b=a.get_string("confirmation","block_massaction",s);t.when(b).done(function(t){return!!window.confirm(t)})}break;case"move":case"clone":m=t("#block-massaction-"+k).val()}if(t("#block-massaction-action").val(k),t("#block-massaction-activities").val(JSON.stringify(o)),t("#block-massaction-target").val(m),s>0)t("#block-massaction-control-form").submit();else{var p=a.get_string("noitemselected","block_massaction");t.when(p).done(function(t){window.alert(t)})}}}});